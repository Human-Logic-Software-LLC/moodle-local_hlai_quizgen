<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="local/hlai_quizgen/db" VERSION="20251113" COMMENT="XMLDB file for Moodle local/hlai_quizgen"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd"
>
  <TABLES>
    <TABLE NAME="local_hlai_quizgen_requests" COMMENT="Stores question generation requests">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Course ID"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="User who created request"/>
        <FIELD NAME="status" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="pending" SEQUENCE="false" COMMENT="pending, processing, completed, failed"/>
        <FIELD NAME="content_sources" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON array of content sources (files, activities)"/>
        <FIELD NAME="total_questions" TYPE="int" LENGTH="5" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Total number of questions to generate"/>
        <FIELD NAME="questions_generated" TYPE="int" LENGTH="5" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Number of questions generated so far"/>
        <FIELD NAME="processing_mode" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="balanced" SEQUENCE="false" COMMENT="fast, balanced, best"/>
        <FIELD NAME="prompt_tokens" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Total prompt tokens used"/>
        <FIELD NAME="response_tokens" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Total response tokens used"/>
        <FIELD NAME="total_tokens" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Total tokens used"/>
        <FIELD NAME="difficulty_distribution" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON object: {easy: 30, medium: 50, hard: 20}"/>
        <FIELD NAME="blooms_distribution" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON object: Bloom's taxonomy distribution"/>
        <FIELD NAME="question_types" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON array: [multichoice, truefalse, shortanswer, essay, matching]"/>
        <FIELD NAME="custom_instructions" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Optional custom instructions from teacher"/>
        <FIELD NAME="content_hash" TYPE="char" LENGTH="64" NOTNULL="false" SEQUENCE="false" COMMENT="SHA-256 hash of content for deduplication"/>
        <FIELD NAME="error_message" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Error message if failed"/>
        <FIELD NAME="progress" TYPE="number" LENGTH="10" NOTNULL="true" DEFAULT="0" DECIMALS="2" SEQUENCE="false" COMMENT="Progress percentage 0-100"/>
        <FIELD NAME="progress_message" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Current progress message"/>
        <FIELD NAME="category_name" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Custom category name for quiz"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="timecompleted" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="When request completed or failed"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="courseid" TYPE="foreign" FIELDS="courseid" REFTABLE="course" REFFIELDS="id"/>
        <KEY NAME="userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="status" UNIQUE="false" FIELDS="status"/>
        <INDEX NAME="courseid_userid" UNIQUE="false" FIELDS="courseid, userid"/>
        <INDEX NAME="content_hash" UNIQUE="false" FIELDS="content_hash"/>
      </INDEXES>
    </TABLE>
    
    <TABLE NAME="local_hlai_quizgen_topics" COMMENT="Stores extracted topics from content analysis">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="requestid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Parent request ID"/>
        <FIELD NAME="title" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Topic title"/>
        <FIELD NAME="description" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Topic description"/>
        <FIELD NAME="parent_topic_id" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Parent topic ID for subtopics"/>
        <FIELD NAME="level" TYPE="int" LENGTH="2" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="1=main topic, 2=subtopic"/>
        <FIELD NAME="selected" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="1 if teacher selected for assessment"/>
        <FIELD NAME="num_questions" TYPE="int" LENGTH="5" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="Number of questions to generate for this topic"/>
        <FIELD NAME="content_excerpt" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Excerpt of content for this topic"/>
        <FIELD NAME="learning_objectives" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON array of learning objectives"/>
        <FIELD NAME="difficulty_distribution" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON object: {easy: 30, medium: 50, hard: 20}"/>
        <FIELD NAME="blooms_distribution" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON object: Bloom's taxonomy distribution"/>
        <FIELD NAME="question_types" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON object: Question type distribution"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="requestid" TYPE="foreign" FIELDS="requestid" REFTABLE="local_hlai_quizgen_requests" REFFIELDS="id"/>
        <KEY NAME="parent_topic_id" TYPE="foreign" FIELDS="parent_topic_id" REFTABLE="local_hlai_quizgen_topics" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="requestid_selected" UNIQUE="false" FIELDS="requestid, selected"/>
      </INDEXES>
    </TABLE>
    
    <TABLE NAME="local_hlai_quizgen_questions" COMMENT="Stores generated questions">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="requestid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Parent request ID"/>
        <FIELD NAME="topicid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Topic ID"/>
        <FIELD NAME="questiontype" TYPE="char" LENGTH="50" NOTNULL="true" SEQUENCE="false" COMMENT="multichoice, truefalse, shortanswer, essay, matching"/>
        <FIELD NAME="questiontext" TYPE="text" NOTNULL="true" SEQUENCE="false" COMMENT="Question text"/>
        <FIELD NAME="questiontextformat" TYPE="int" LENGTH="2" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="Text format (HTML, etc)"/>
        <FIELD NAME="generalfeedback" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="General feedback"/>
        <FIELD NAME="difficulty" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="medium" SEQUENCE="false" COMMENT="easy, medium, hard"/>
        <FIELD NAME="blooms_level" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="remember, understand, apply, analyze, evaluate, create"/>
        <FIELD NAME="ai_reasoning" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Why AI generated this question"/>
        <FIELD NAME="status" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="pending" SEQUENCE="false" COMMENT="pending, approved, rejected, deployed"/>
        <FIELD NAME="rejection_reason" TYPE="char" LENGTH="100" NOTNULL="false" SEQUENCE="false" COMMENT="Reason for question rejection"/>
        <FIELD NAME="rejection_feedback" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Detailed feedback on rejection"/>
        <FIELD NAME="accepted_on_first_try" TYPE="int" LENGTH="1" NOTNULL="false" SEQUENCE="false" COMMENT="1=accepted first try, 0=not"/>
        <FIELD NAME="time_approved" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Timestamp when approved"/>
        <FIELD NAME="review_duration" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Time spent reviewing in seconds"/>
        <FIELD NAME="validation_score" TYPE="int" LENGTH="3" NOTNULL="false" SEQUENCE="false" COMMENT="Quality validation score 0-100"/>
        <FIELD NAME="quality_rating" TYPE="char" LENGTH="20" NOTNULL="false" SEQUENCE="false" COMMENT="excellent, good, acceptable, poor, unacceptable"/>
        <FIELD NAME="moodle_questionid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="ID in mdl_question table after deployment"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="timedeployed" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="regeneration_count" TYPE="int" LENGTH="3" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Number of times this question has been regenerated"/>
        <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Course ID"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="User who created this question"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="requestid" TYPE="foreign" FIELDS="requestid" REFTABLE="local_hlai_quizgen_requests" REFFIELDS="id"/>
        <KEY NAME="topicid" TYPE="foreign" FIELDS="topicid" REFTABLE="local_hlai_quizgen_topics" REFFIELDS="id"/>
        <KEY NAME="courseid" TYPE="foreign" FIELDS="courseid" REFTABLE="course" REFFIELDS="id"/>
        <KEY NAME="userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="requestid_status" UNIQUE="false" FIELDS="requestid, status"/>
        <INDEX NAME="questiontype" UNIQUE="false" FIELDS="questiontype"/>
        <INDEX NAME="status_rejection" UNIQUE="false" FIELDS="status, rejection_reason"/>
        <INDEX NAME="accepted_first_try" UNIQUE="false" FIELDS="accepted_on_first_try, status"/>
      </INDEXES>
    </TABLE>
    
    <TABLE NAME="local_hlai_quizgen_answers" COMMENT="Stores question answers and distractors">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="questionid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Parent question ID"/>
        <FIELD NAME="answer" TYPE="text" NOTNULL="true" SEQUENCE="false" COMMENT="Answer text"/>
        <FIELD NAME="answerformat" TYPE="int" LENGTH="2" NOTNULL="true" DEFAULT="1" SEQUENCE="false"/>
        <FIELD NAME="fraction" TYPE="number" LENGTH="12" NOTNULL="true" DEFAULT="0.0" DECIMALS="7" SEQUENCE="false" COMMENT="1.0 for correct, 0.0 for incorrect, partial credit possible"/>
        <FIELD NAME="feedback" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Feedback for this answer"/>
        <FIELD NAME="feedbackformat" TYPE="int" LENGTH="2" NOTNULL="true" DEFAULT="1" SEQUENCE="false"/>
        <FIELD NAME="is_correct" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="1 if correct answer"/>
        <FIELD NAME="distractor_reasoning" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Why this distractor is plausible"/>
        <FIELD NAME="plausibility_score" TYPE="number" LENGTH="3" NOTNULL="false" DECIMALS="2" SEQUENCE="false" COMMENT="Distractor plausibility score"/>
        <FIELD NAME="sortorder" TYPE="int" LENGTH="5" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="questionid" TYPE="foreign" FIELDS="questionid" REFTABLE="local_hlai_quizgen_questions" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="questionid_sortorder" UNIQUE="false" FIELDS="questionid, sortorder"/>
      </INDEXES>
    </TABLE>
    
    <TABLE NAME="local_hlai_quizgen_settings" COMMENT="Stores user-specific settings and preferences">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="NULL for global settings"/>
        <FIELD NAME="setting_name" TYPE="char" LENGTH="100" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="setting_value" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="userid_courseid_name" UNIQUE="true" FIELDS="userid, courseid, setting_name"/>
      </INDEXES>
    </TABLE>
    
    <TABLE NAME="local_hlai_quizgen_logs" COMMENT="Audit log for AI operations and user actions">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="requestid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Related request ID"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="action" TYPE="char" LENGTH="100" NOTNULL="true" SEQUENCE="false" COMMENT="Action type: content_analyzed, questions_generated, question_edited, etc"/>
        <FIELD NAME="component" TYPE="char" LENGTH="100" NOTNULL="false" SEQUENCE="false" COMMENT="Component that triggered action"/>
        <FIELD NAME="details" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON object with action details"/>
        <FIELD NAME="tokens_used" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="AI tokens consumed"/>
        <FIELD NAME="response_time" TYPE="number" LENGTH="10" NOTNULL="false" DECIMALS="3" SEQUENCE="false" COMMENT="AI response time in seconds"/>
        <FIELD NAME="status" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="success" SEQUENCE="false" COMMENT="success, error"/>
        <FIELD NAME="error_message" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="requestid" TYPE="foreign" FIELDS="requestid" REFTABLE="local_hlai_quizgen_requests" REFFIELDS="id"/>
        <KEY NAME="userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="action_status" UNIQUE="false" FIELDS="action, status"/>
        <INDEX NAME="timecreated" UNIQUE="false" FIELDS="timecreated"/>
      </INDEXES>
    </TABLE>
    
    <TABLE NAME="local_hlai_quizgen_urlcont" COMMENT="Stores extracted content from URLs">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="requestid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Parent request ID"/>
        <FIELD NAME="url" TYPE="text" NOTNULL="true" SEQUENCE="false" COMMENT="Source URL"/>
        <FIELD NAME="title" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Page title"/>
        <FIELD NAME="content" TYPE="text" NOTNULL="true" SEQUENCE="false" COMMENT="Extracted text content"/>
        <FIELD NAME="word_count" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Word count"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="requestid" TYPE="foreign" FIELDS="requestid" REFTABLE="local_hlai_quizgen_requests" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="requestid" UNIQUE="false" FIELDS="requestid"/>
      </INDEXES>
    </TABLE>
    
    <TABLE NAME="local_hlai_quizgen_cache" COMMENT="Cache for AI responses to reduce API calls">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="cachetype" TYPE="char" LENGTH="50" NOTNULL="true" SEQUENCE="false" COMMENT="Type: topics, questions, distractors"/>
        <FIELD NAME="cachekey" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Unique cache key (hash)"/>
        <FIELD NAME="data" TYPE="text" NOTNULL="true" SEQUENCE="false" COMMENT="Cached JSON data"/>
        <FIELD NAME="metadata" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Additional metadata"/>
        <FIELD NAME="hits" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Number of cache hits"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="lastaccessed" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="cachetype_key" UNIQUE="true" FIELDS="cachetype, cachekey"/>
        <INDEX NAME="timecreated" UNIQUE="false" FIELDS="timecreated"/>
        <INDEX NAME="lastaccessed" UNIQUE="false" FIELDS="lastaccessed"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="local_hlai_quizgen_reviews" COMMENT="Peer review and approval workflow">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="questionid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="reviewerid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="User assigned to review"/>
        <FIELD NAME="submitterid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="User who submitted for review"/>
        <FIELD NAME="status" TYPE="char" LENGTH="50" NOTNULL="true" SEQUENCE="false" COMMENT="pending_review, in_review, approved, rejected, needs_revision, revised"/>
        <FIELD NAME="review_type" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="peer" SEQUENCE="false"/>
        <FIELD NAME="priority" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="normal" SEQUENCE="false"/>
        <FIELD NAME="instructions" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="decision" TYPE="char" LENGTH="20" NOTNULL="false" SEQUENCE="false" COMMENT="approve or reject"/>
        <FIELD NAME="decision_comments" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="decision_userid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="due_date" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="timestarted" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="timecompleted" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="questionid" TYPE="foreign" FIELDS="questionid" REFTABLE="local_hlai_quizgen_questions" REFFIELDS="id"/>
        <KEY NAME="reviewerid" TYPE="foreign" FIELDS="reviewerid" REFTABLE="user" REFFIELDS="id"/>
        <KEY NAME="submitterid" TYPE="foreign" FIELDS="submitterid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="status" UNIQUE="false" FIELDS="status"/>
        <INDEX NAME="reviewer_status" UNIQUE="false" FIELDS="reviewerid, status"/>
        <INDEX NAME="due_date" UNIQUE="false" FIELDS="due_date"/>
      </INDEXES>
    </TABLE>
    
    
    <TABLE NAME="local_hlai_quizgen_revisions" COMMENT="Revision history">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="reviewid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="changes" TYPE="text" NOTNULL="true" SEQUENCE="false" COMMENT="JSON changes"/>
        <FIELD NAME="revision_notes" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="reviewid" TYPE="foreign" FIELDS="reviewid" REFTABLE="local_hlai_quizgen_reviews" REFFIELDS="id"/>
        <KEY NAME="userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="reviewid_time" UNIQUE="false" FIELDS="reviewid, timecreated"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="local_hlai_quizgen_wizstate" COMMENT="Stores wizard session state for resumption">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="current_step" TYPE="int" LENGTH="2" NOTNULL="true" DEFAULT="1" SEQUENCE="false"/>
        <FIELD NAME="state_data" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON-encoded wizard state"/>
        <FIELD NAME="request_id" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Link to active request"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
        <KEY NAME="courseid" TYPE="foreign" FIELDS="courseid" REFTABLE="course" REFFIELDS="id"/>
        <KEY NAME="request_id" TYPE="foreign" FIELDS="request_id" REFTABLE="local_hlai_quizgen_requests" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="userid_courseid" UNIQUE="true" FIELDS="userid, courseid"/>
        <INDEX NAME="timemodified" UNIQUE="false" FIELDS="timemodified"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="local_hlai_quizgen_ratelog" COMMENT="Rate limiting log for API calls">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="User making the request"/>
        <FIELD NAME="limittype" TYPE="char" LENGTH="50" NOTNULL="true" SEQUENCE="false" COMMENT="Type of rate limit"/>
        <FIELD NAME="details" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON details of the violation"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="userid_time" UNIQUE="false" FIELDS="userid, timecreated"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="local_hlai_quizgen_templates" COMMENT="Reusable configuration presets for question generation">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="name" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Template name"/>
        <FIELD NAME="description" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="is_public" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Whether template is shared"/>
        <FIELD NAME="is_default" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Whether template is default"/>
        <FIELD NAME="config_data" TYPE="text" NOTNULL="true" SEQUENCE="false" COMMENT="JSON configuration data"/>
        <FIELD NAME="usage_count" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
        <KEY NAME="courseid" TYPE="foreign" FIELDS="courseid" REFTABLE="course" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="userid_public" UNIQUE="false" FIELDS="userid, is_public"/>
        <INDEX NAME="courseid_public" UNIQUE="false" FIELDS="courseid, is_public"/>
        <INDEX NAME="is_default" UNIQUE="false" FIELDS="is_default"/>
      </INDEXES>
    </TABLE>
  </TABLES>
</XMLDB>
