{"version":3,"file":"wizard.min.js","sources":["../src/wizard.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * AI Quiz Generator - Wizard Module\n *\n * Handles all wizard step interactions, form validation, and UI behaviour\n * across the 5-step quiz generation wizard. Replaces inline JavaScript\n * previously embedded in wizard.php.\n *\n * Initialized via:\n *   $PAGE->requires->js_call_amd('local_hlai_quizgen/wizard', 'init', [$jsconfig]);\n *\n * @module     local_hlai_quizgen/wizard\n * @copyright  2025 Human Logic Software LLC\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function($) {\n    'use strict';\n\n    /**\n     * Wizard controller object.\n     * Manages per-step initialization and all DOM event binding.\n     *\n     * @namespace\n     */\n    var Wizard = {\n\n        /** @type {Object} Configuration passed from PHP. */\n        config: {},\n\n        // -----------------------------------------------------------------\n        // Core\n        // -----------------------------------------------------------------\n\n        /**\n         * Initialize the wizard for the current step.\n         *\n         * @param {Object} config - Configuration from PHP.\n         * @param {number} config.courseid - Course ID.\n         * @param {number} config.requestid - Request ID.\n         * @param {string} config.step - Current step ('1','2','3','3.5','4','5').\n         * @param {string} [config.refreshUrl] - Auto-refresh URL for step 3.5.\n         * @param {Object} [config.strings] - Translation strings.\n         */\n        init: function(config) {\n            this.config = config;\n            var step = String(config.step);\n\n            switch (step) {\n                case '1':\n                    this.initStep1();\n                    break;\n                case '3':\n                    this.initStep3();\n                    break;\n                case '3.5':\n                    this.initProgressStep();\n                    break;\n                case '4':\n                    this.initStep4();\n                    break;\n                case '5':\n                    this.initStep5();\n                    break;\n                // Steps 2 and others may not require client-side JS.\n            }\n        },\n\n        // =================================================================\n        // Step 1 - Content Upload\n        // =================================================================\n\n        /**\n         * Initialize Step 1 handlers: form validation, content-source\n         * toggles, file-input feedback, and activity selection helpers.\n         */\n        initStep1: function() {\n            this._bindStep1FormSubmit();\n            this._bindContentSourceToggles();\n            this._bindFileInputChange();\n            this._bindActivitySelectionControls();\n        },\n\n        // -----------------------------------------------------------------\n        // Step 1 - Form submit validation\n        // -----------------------------------------------------------------\n\n        /**\n         * Attach a submit handler to the content-upload form that validates\n         * all selected content sources before allowing the POST.\n         *\n         * @private\n         */\n        _bindStep1FormSubmit: function() {\n            var self = this;\n            var form = document.getElementById('content-upload-form');\n            if (!form) {\n                // Fallback: try to locate the multipart form on the page.\n                form = document.querySelector('form[enctype=\"multipart/form-data\"]');\n            }\n            if (form) {\n                form.addEventListener('submit', function(e) {\n                    if (!self._validateStep1Form()) {\n                        e.preventDefault();\n                    }\n                });\n            }\n        },\n\n        /**\n         * Validate the Step 1 content-upload form.\n         * Ensures at least one source is selected and each selected source\n         * has the required data filled in.\n         *\n         * @private\n         * @return {boolean} True if the form is valid.\n         */\n        _validateStep1Form: function() {\n            var states = this._getSourceStates();\n\n            if (!this._validateSourceSelected(states)) {\n                return false;\n            }\n            if (states.manualChecked && !this._validateManualSource()) {\n                return false;\n            }\n            if (states.uploadChecked && !this._validateUploadSource()) {\n                return false;\n            }\n            if (states.urlChecked && !this._validateUrlSource()) {\n                return false;\n            }\n            if (states.activitiesChecked && !this._validateActivitySource()) {\n                return false;\n            }\n\n            return true;\n        },\n\n        /**\n         * Gather the checked state of all content-source checkboxes.\n         *\n         * @private\n         * @return {Object} Map of source checkbox states.\n         */\n        _getSourceStates: function() {\n            var get = function(id) {\n                var el = document.getElementById(id);\n                return el ? el.checked : false;\n            };\n            return {\n                manualChecked: get('source_manual'),\n                uploadChecked: get('source_upload'),\n                urlChecked: get('source_url'),\n                activitiesChecked: get('source_activities'),\n                scanCourseChecked: get('source_scan_course'),\n                scanResourcesChecked: get('source_scan_resources'),\n                scanActivitiesChecked: get('source_scan_activities')\n            };\n        },\n\n        /**\n         * Validate that at least one content source is selected.\n         *\n         * @private\n         * @param {Object} states - Source checkbox states from _getSourceStates.\n         * @return {boolean} True if at least one source is selected.\n         */\n        _validateSourceSelected: function(states) {\n            if (!states.manualChecked && !states.uploadChecked && !states.urlChecked &&\n                !states.activitiesChecked && !states.scanCourseChecked &&\n                !states.scanResourcesChecked && !states.scanActivitiesChecked) {\n                // eslint-disable-next-line no-alert\n                alert('Please select at least one content source!');\n                return false;\n            }\n            return true;\n        },\n\n        /**\n         * Validate that manual text has been entered.\n         *\n         * @private\n         * @return {boolean} True if manual text is valid.\n         */\n        _validateManualSource: function() {\n            var manualTextEl = document.getElementById('manual_text');\n            var manualText = manualTextEl ? manualTextEl.value.trim() : '';\n            if (manualText === '') {\n                // eslint-disable-next-line no-alert\n                alert('Please enter some manual text or uncheck the Manual Entry option.');\n                return false;\n            }\n            return true;\n        },\n\n        /**\n         * Validate that files have been selected and none exceed the size limit.\n         *\n         * @private\n         * @return {boolean} True if the upload is valid.\n         */\n        _validateUploadSource: function() {\n            var fileInput = document.getElementById('content-files');\n            var files = fileInput ? fileInput.files : [];\n            if (files.length === 0) {\n                // eslint-disable-next-line no-alert\n                alert('Please select files to upload or uncheck the Upload Files option.');\n                return false;\n            }\n            var maxFileSizeMB = 50;\n            var maxFileSizeBytes = maxFileSizeMB * 1024 * 1024;\n            var oversizedFiles = [];\n            Array.from(files).forEach(function(file) {\n                if (file.size > maxFileSizeBytes) {\n                    oversizedFiles.push(file.name + ' (' + (file.size / 1024 / 1024).toFixed(2) + ' MB)');\n                }\n            });\n            if (oversizedFiles.length > 0) {\n                // eslint-disable-next-line no-alert\n                alert('The following files exceed the maximum size of ' + maxFileSizeMB + ' MB:\\n\\n' +\n                    oversizedFiles.join('\\n') + '\\n\\nPlease remove these files and try again.');\n                return false;\n            }\n            return true;\n        },\n\n        /**\n         * Validate that at least one URL has been entered.\n         *\n         * @private\n         * @return {boolean} True if the URL input is valid.\n         */\n        _validateUrlSource: function() {\n            var urlListEl = document.getElementById('url_list');\n            var urlList = urlListEl ? urlListEl.value.trim() : '';\n            if (urlList === '') {\n                // eslint-disable-next-line no-alert\n                alert('Please enter at least one URL or uncheck the URL option.');\n                return false;\n            }\n            return true;\n        },\n\n        /**\n         * Validate that at least one activity is selected.\n         *\n         * @private\n         * @return {boolean} True if the activity selection is valid.\n         */\n        _validateActivitySource: function() {\n            var selectedActivities = document.querySelectorAll('.hlai-activity-checkbox:checked');\n            if (selectedActivities.length === 0) {\n                // eslint-disable-next-line no-alert\n                alert('Please select at least one activity or uncheck the Course Activities option.');\n                return false;\n            }\n            return true;\n        },\n\n        // -----------------------------------------------------------------\n        // Step 1 - Content source toggles\n        // -----------------------------------------------------------------\n\n        /**\n         * Bind change handlers on content-source checkboxes so that the\n         * corresponding detail section is shown/hidden and the\n         * \"selected sources\" summary strip is updated.\n         *\n         * @private\n         */\n        _bindContentSourceToggles: function() {\n            var self = this;\n            document.querySelectorAll('.content-source-checkbox[data-source]').forEach(function(cb) {\n                cb.addEventListener('change', function() {\n                    self._toggleContentSection(this.dataset.source);\n                });\n            });\n        },\n\n        /**\n         * Show or hide the detail section for a given content source and\n         * refresh the summary strip.\n         *\n         * @private\n         * @param {string} source - Source key (e.g. 'manual', 'upload').\n         */\n        _toggleContentSection: function(source) {\n            var checkbox = document.getElementById('source_' + source);\n            var section = document.getElementById('section-' + source);\n            if (section && checkbox) {\n                section.style.display = checkbox.checked ? 'block' : 'none';\n            }\n            this._updateSelectedSources();\n        },\n\n        /**\n         * Refresh the \"selected sources\" summary strip based on currently\n         * checked content-source checkboxes.\n         *\n         * @private\n         */\n        _updateSelectedSources: function() {\n            var checkboxes = document.querySelectorAll('.content-source-checkbox:checked');\n            var display = document.getElementById('selected-sources-display');\n            var list = document.getElementById('selected-sources-list');\n\n            if (checkboxes.length > 0) {\n                var sources = [];\n                checkboxes.forEach(function(cb) {\n                    var label = document.querySelector('label[for=\"' + cb.id + '\"] strong');\n                    if (label) {\n                        sources.push(label.textContent);\n                    }\n                });\n                if (list) {\n                    list.textContent = sources.join(' + ');\n                }\n                if (display) {\n                    display.style.display = 'block';\n                }\n            } else {\n                if (display) {\n                    display.style.display = 'none';\n                }\n            }\n        },\n\n        // -----------------------------------------------------------------\n        // Step 1 - File input feedback\n        // -----------------------------------------------------------------\n\n        /**\n         * Bind a change handler on the file input to display selected\n         * file names and flag oversized files.\n         *\n         * @private\n         */\n        _bindFileInputChange: function() {\n            var self = this;\n            var fileInput = document.getElementById('content-files');\n            if (!fileInput) {\n                return;\n            }\n\n            fileInput.addEventListener('change', function(e) {\n                var fileCount = e.target.files.length;\n                var label = e.target.nextElementSibling;\n                var fileList = document.getElementById('uploaded-files-list');\n                var maxFileSizeMB = 50;\n                var maxFileSizeBytes = maxFileSizeMB * 1024 * 1024;\n                var hasOversizedFiles = false;\n                var oversizedFileNames = [];\n\n                if (fileCount > 0) {\n                    if (label) {\n                        label.innerText = fileCount + ' file(s) selected';\n                    }\n                    var fileNames = '<div class=\"mt-2\"><strong>Selected files:</strong><ul class=\"mb-0\">';\n                    Array.from(e.target.files).forEach(function(file) {\n                        // Safely escape the file name via textContent.\n                        var safeEl = document.createElement('div');\n                        safeEl.textContent = file.name;\n                        var safeFileName = safeEl.innerHTML;\n                        var fileSizeMB = (file.size / 1024 / 1024).toFixed(2);\n                        var sizeClass = file.size > maxFileSizeBytes ? 'text-danger' : 'text-muted';\n\n                        if (file.size > maxFileSizeBytes) {\n                            hasOversizedFiles = true;\n                            oversizedFileNames.push(file.name + ' (' + fileSizeMB + ' MB)');\n                            fileNames += '<li class=\"text-danger\">' + safeFileName +\n                                ' <span class=\"' + sizeClass + '\">(' + fileSizeMB + ' MB) - TOO LARGE!</span></li>';\n                        } else {\n                            fileNames += '<li>' + safeFileName +\n                                ' <span class=\"' + sizeClass + '\">(' + fileSizeMB + ' MB)</span></li>';\n                        }\n                    });\n                    fileNames += '</ul></div>';\n\n                    if (hasOversizedFiles) {\n                        fileNames += '<div class=\"notification is-danger is-light mt-2\"><strong>Error:</strong> ' +\n                            'The following files exceed the maximum size of ' + maxFileSizeMB + ' MB:<ul>';\n                        oversizedFileNames.forEach(function(fname) {\n                            fileNames += '<li>' + fname + '</li>';\n                        });\n                        fileNames += '</ul>Please remove these files before submitting.</div>';\n                    }\n\n                    if (fileList) {\n                        fileList.innerHTML = fileNames;\n                    }\n                } else {\n                    var chooseFilesText = (self.config.strings && self.config.strings.choose_files)\n                        ? self.config.strings.choose_files\n                        : 'Choose files...';\n                    if (label) {\n                        label.innerText = chooseFilesText;\n                    }\n                    if (fileList) {\n                        fileList.innerHTML = '';\n                    }\n                }\n            });\n        },\n\n        // -----------------------------------------------------------------\n        // Step 1 - Activity selection helpers\n        // -----------------------------------------------------------------\n\n        /**\n         * Bind the select-all / deselect-all buttons and per-checkbox\n         * change events for the activity picker, then run an initial\n         * count update.\n         *\n         * @private\n         */\n        _bindActivitySelectionControls: function() {\n            var self = this;\n\n            var selectAllBtn = document.getElementById('select-all-activities');\n            if (selectAllBtn) {\n                selectAllBtn.addEventListener('click', function() {\n                    document.querySelectorAll('.hlai-activity-checkbox').forEach(function(cb) {\n                        cb.checked = true;\n                    });\n                    self._updateActivityCount();\n                });\n            }\n\n            var deselectAllBtn = document.getElementById('deselect-all-activities');\n            if (deselectAllBtn) {\n                deselectAllBtn.addEventListener('click', function() {\n                    document.querySelectorAll('.hlai-activity-checkbox').forEach(function(cb) {\n                        cb.checked = false;\n                    });\n                    self._updateActivityCount();\n                });\n            }\n\n            document.querySelectorAll('.hlai-activity-checkbox').forEach(function(cb) {\n                cb.addEventListener('change', function() {\n                    self._updateActivityCount();\n                });\n            });\n\n            // Initial count.\n            this._updateActivityCount();\n        },\n\n        /**\n         * Refresh the activity count display and toggle the visual\n         * \"selected\" state on each activity card.\n         *\n         * @private\n         */\n        _updateActivityCount: function() {\n            var checked = document.querySelectorAll('.hlai-activity-checkbox:checked').length;\n            var countDisplay = document.getElementById('selected-activities-count');\n            var selectedBar = document.querySelector('.hlai-activities-selected-bar');\n\n            if (countDisplay) {\n                var text = checked === 1\n                    ? '1 activity selected'\n                    : checked + ' activities selected';\n                countDisplay.textContent = text;\n            }\n\n            if (selectedBar) {\n                if (checked > 0) {\n                    selectedBar.classList.add('has-selection');\n                } else {\n                    selectedBar.classList.remove('has-selection');\n                }\n            }\n\n            document.querySelectorAll('.hlai-activity-checkbox').forEach(function(cb) {\n                var card = cb.closest('.hlai-activity-card');\n                if (card) {\n                    if (cb.checked) {\n                        card.classList.add('is-selected');\n                    } else {\n                        card.classList.remove('is-selected');\n                    }\n                }\n            });\n        },\n\n        // =================================================================\n        // Step 3 - Question Configuration\n        // =================================================================\n\n        /**\n         * Initialize Step 3 handlers: difficulty buttons, Bloom's sliders,\n         * question-type distribution inputs, and the generate form submit.\n         */\n        initStep3: function() {\n            this._bindDifficultyButtons();\n            this._bindBloomsSliders();\n            this._bindQuestionTypeDistribution();\n            this._bindStep3FormSubmit();\n        },\n\n        // -----------------------------------------------------------------\n        // Step 3 - Difficulty radio buttons\n        // -----------------------------------------------------------------\n\n        /**\n         * Bind change handlers on the difficulty radio buttons so that the\n         * active visual state follows the currently selected option.\n         *\n         * @private\n         */\n        _bindDifficultyButtons: function() {\n            document.querySelectorAll('.hlai-diff-btn input[type=\"radio\"]').forEach(function(radio) {\n                radio.addEventListener('change', function() {\n                    document.querySelectorAll('.hlai-diff-btn').forEach(function(btn) {\n                        btn.classList.remove('is-active');\n                    });\n                    if (this.parentElement) {\n                        this.parentElement.classList.add('is-active');\n                    }\n                });\n            });\n        },\n\n        // -----------------------------------------------------------------\n        // Step 3 - Bloom's taxonomy sliders\n        // -----------------------------------------------------------------\n\n        /**\n         * Bind input handlers on the Bloom's taxonomy range sliders so\n         * that the percentage labels and track fills update live, and the\n         * running total is recalculated on each change.\n         *\n         * @private\n         */\n        _bindBloomsSliders: function() {\n            var self = this;\n            document.querySelectorAll('input[type=\"range\"][id^=\"blooms_\"]').forEach(function(slider) {\n                // Apply initial styling.\n                self._updateSliderColor(slider);\n                slider.addEventListener('input', function() {\n                    self._updateSliderColor(this);\n                    self._updateBloomsTotal();\n                });\n            });\n            // Set the initial total.\n            this._updateBloomsTotal();\n        },\n\n        /**\n         * Update the track fill colour and value label for a single\n         * Bloom's slider.\n         *\n         * @private\n         * @param {HTMLInputElement} slider - The range input element.\n         */\n        _updateSliderColor: function(slider) {\n            var value = slider.value;\n            var id = slider.id;\n            var color = slider.dataset.color || '#6366f1';\n            var valueEl = document.getElementById(id + '_value');\n            if (valueEl) {\n                valueEl.textContent = value + '%';\n            }\n            slider.style.background = 'linear-gradient(to right, ' + color + ' 0%, ' + color +\n                ' ' + value + '%, #e2e8f0 ' + value + '%, #e2e8f0 100%)';\n        },\n\n        /**\n         * Recalculate and display the Bloom's taxonomy total percentage\n         * with appropriate colour coding.\n         *\n         * @private\n         */\n        _updateBloomsTotal: function() {\n            var levels = ['remember', 'understand', 'apply', 'analyze', 'evaluate', 'create'];\n            var total = 0;\n            levels.forEach(function(level) {\n                var slider = document.getElementById('blooms_' + level);\n                if (slider) {\n                    total += parseInt(slider.value, 10);\n                }\n            });\n            var totalElem = document.getElementById('blooms_total');\n            if (totalElem) {\n                totalElem.textContent = total + '%';\n                if (total === 100) {\n                    totalElem.style.color = '#10b981';\n                } else if (total > 80 && total < 120) {\n                    totalElem.style.color = '#f59e0b';\n                } else {\n                    totalElem.style.color = '#ef4444';\n                }\n            }\n        },\n\n        // -----------------------------------------------------------------\n        // Step 3 - Question type distribution\n        // -----------------------------------------------------------------\n\n        /**\n         * Bind input handlers on the question-type number inputs and the\n         * total-questions field so the running total stays in sync.\n         *\n         * @private\n         */\n        _bindQuestionTypeDistribution: function() {\n            var self = this;\n            var totalInput = document.getElementById('total-questions');\n\n            if (totalInput) {\n                totalInput.addEventListener('input', function() {\n                    self._updateQuestionTypeDistribution();\n                });\n            }\n\n            document.querySelectorAll('.hlai-qtype-input').forEach(function(input) {\n                input.addEventListener('input', function() {\n                    self._updateQuestionTypeTotal();\n                });\n            });\n\n            // Initial calculation.\n            this._updateQuestionTypeTotal();\n        },\n\n        /**\n         * When the total-questions value changes, update the denominator\n         * in the distribution display and adjust the max on each\n         * question-type input.\n         *\n         * @private\n         */\n        _updateQuestionTypeDistribution: function() {\n            var totalInput = document.getElementById('total-questions');\n            var total = totalInput ? (parseInt(totalInput.value, 10) || 10) : 10;\n            var displayEl = document.getElementById('qtype-total-display');\n\n            if (displayEl) {\n                var parts = displayEl.textContent.split('/');\n                displayEl.textContent = (parts[0] ? parts[0].trim() : '0') + ' / ' + total;\n            }\n\n            document.querySelectorAll('.hlai-qtype-input').forEach(function(input) {\n                input.max = total;\n            });\n\n            this._updateQuestionTypeTotal();\n        },\n\n        /**\n         * Recalculate the sum of all question-type inputs and update the\n         * visual indicator (valid / warning / error).\n         *\n         * @private\n         */\n        _updateQuestionTypeTotal: function() {\n            var totalInput = document.getElementById('total-questions');\n            var totalRequired = totalInput ? (parseInt(totalInput.value, 10) || 10) : 10;\n            var total = 0;\n\n            document.querySelectorAll('.hlai-qtype-input').forEach(function(input) {\n                var val = parseInt(input.value, 10) || 0;\n                total += val;\n                if (val > 0) {\n                    input.classList.add('has-value');\n                } else {\n                    input.classList.remove('has-value');\n                }\n            });\n\n            var displayEl = document.getElementById('qtype-total-display');\n            if (displayEl) {\n                displayEl.textContent = total + ' / ' + totalRequired;\n                displayEl.classList.remove('is-valid', 'is-warning', 'is-error');\n                if (total === totalRequired) {\n                    displayEl.classList.add('is-valid');\n                } else if (total > totalRequired) {\n                    displayEl.classList.add('is-error');\n                } else {\n                    displayEl.classList.add('is-warning');\n                }\n            }\n        },\n\n        // -----------------------------------------------------------------\n        // Step 3 - Generate form submit\n        // -----------------------------------------------------------------\n\n        /**\n         * Bind the submit handler on the question-config form to validate\n         * totals and show a loading overlay while the request is in flight.\n         *\n         * @private\n         */\n        _bindStep3FormSubmit: function() {\n            var configForm = document.getElementById('question-config-form');\n            var generateBtn = document.getElementById('generate-btn');\n            var loadingOverlay = document.getElementById('loading-overlay');\n            var totalInput = document.getElementById('total-questions');\n            var isSubmitting = false;\n\n            if (configForm) {\n                configForm.addEventListener('submit', function(e) {\n                    var totalRequired = totalInput ? (parseInt(totalInput.value, 10) || 10) : 10;\n                    var total = 0;\n\n                    document.querySelectorAll('.hlai-qtype-input').forEach(function(input) {\n                        total += parseInt(input.value, 10) || 0;\n                    });\n\n                    if (total === 0) {\n                        e.preventDefault();\n                        // eslint-disable-next-line no-alert\n                        alert('Please specify at least one question type with a quantity greater than 0.');\n                        return;\n                    }\n\n                    if (total !== totalRequired) {\n                        e.preventDefault();\n                        // eslint-disable-next-line no-alert\n                        alert('Question type total (' + total + ') must equal total questions (' + totalRequired + ').');\n                        return;\n                    }\n\n                    if (isSubmitting) {\n                        e.preventDefault();\n                        return;\n                    }\n\n                    isSubmitting = true;\n\n                    if (loadingOverlay) {\n                        loadingOverlay.style.display = 'flex';\n                    }\n                    if (generateBtn) {\n                        generateBtn.disabled = true;\n                        generateBtn.textContent = 'Generating...';\n                    }\n                });\n            }\n        },\n\n        // =================================================================\n        // Step 3.5 - Generation Progress (auto-refresh)\n        // =================================================================\n\n        /**\n         * Initialize Step 3.5: automatically redirect to the refresh URL\n         * after a short delay so the user sees the progress page before\n         * polling continues.\n         */\n        initProgressStep: function() {\n            var refreshUrl = this.config.refreshUrl;\n            if (refreshUrl) {\n                setTimeout(function() {\n                    window.location.href = refreshUrl;\n                }, 2000);\n            }\n        },\n\n        // =================================================================\n        // Step 4 - Review & Bulk Actions\n        // =================================================================\n\n        /**\n         * Initialize Step 4 handlers: select-all checkbox, bulk-action\n         * button, and filter dropdowns.\n         */\n        initStep4: function() {\n            this._bindSelectAllQuestions();\n            this._bindBulkAction();\n            this._bindQuestionFilters();\n        },\n\n        /**\n         * Bind the \"select all\" checkbox to toggle every visible question\n         * checkbox.\n         *\n         * @private\n         */\n        _bindSelectAllQuestions: function() {\n            var selectAll = document.getElementById('select-all-questions');\n            if (selectAll) {\n                selectAll.addEventListener('change', function() {\n                    var checked = this.checked;\n                    document.querySelectorAll('.question-checkbox').forEach(function(checkbox) {\n                        var card = checkbox.closest('.question-card');\n                        if (card && card.style.display !== 'none') {\n                            checkbox.checked = checked;\n                        }\n                    });\n                });\n            }\n        },\n\n        /**\n         * Bind the bulk-action button so that it collects selected\n         * question IDs and submits them via a dynamically created form.\n         *\n         * @private\n         */\n        _bindBulkAction: function() {\n            var bulkBtn = document.getElementById('bulk-action-btn');\n            if (!bulkBtn) {\n                return;\n            }\n\n            bulkBtn.addEventListener('click', function() {\n                var selectEl = document.getElementById('bulk-action-select');\n                var action = selectEl ? selectEl.value : '';\n\n                if (!action) {\n                    // eslint-disable-next-line no-alert\n                    alert('Please select an action');\n                    return;\n                }\n\n                var selectedQuestions = [];\n                document.querySelectorAll('.question-checkbox:checked').forEach(function(checkbox) {\n                    selectedQuestions.push(checkbox.dataset.questionId);\n                });\n\n                if (selectedQuestions.length === 0) {\n                    // eslint-disable-next-line no-alert\n                    alert('Please select at least one question');\n                    return;\n                }\n\n                var confirmMsg = 'Are you sure you want to ' + action + ' ' +\n                    selectedQuestions.length + ' question(s)?';\n                // eslint-disable-next-line no-alert\n                if (!confirm(confirmMsg)) {\n                    return;\n                }\n\n                // Build and submit a hidden form.\n                var form = document.createElement('form');\n                form.method = 'POST';\n                form.action = window.location.href;\n\n                var sesskeyInput = document.createElement('input');\n                sesskeyInput.type = 'hidden';\n                sesskeyInput.name = 'sesskey';\n                sesskeyInput.value = M.cfg.sesskey;\n                form.appendChild(sesskeyInput);\n\n                var actionInput = document.createElement('input');\n                actionInput.type = 'hidden';\n                actionInput.name = 'bulk_action';\n                actionInput.value = action;\n                form.appendChild(actionInput);\n\n                selectedQuestions.forEach(function(qid) {\n                    var qInput = document.createElement('input');\n                    qInput.type = 'hidden';\n                    qInput.name = 'question_ids[]';\n                    qInput.value = qid;\n                    form.appendChild(qInput);\n                });\n\n                document.body.appendChild(form);\n                form.submit();\n            });\n        },\n\n        /**\n         * Bind change handlers on the status, type, and difficulty filter\n         * dropdowns to show/hide question cards accordingly.\n         *\n         * @private\n         */\n        _bindQuestionFilters: function() {\n            var filterIds = ['filter-status', 'filter-type', 'filter-difficulty'];\n            var applyFilters = function() {\n                var statusEl = document.getElementById('filter-status');\n                var typeEl = document.getElementById('filter-type');\n                var difficultyEl = document.getElementById('filter-difficulty');\n\n                var statusFilter = statusEl ? statusEl.value : 'all';\n                var typeFilter = typeEl ? typeEl.value : 'all';\n                var difficultyFilter = difficultyEl ? difficultyEl.value : 'all';\n\n                document.querySelectorAll('.question-card').forEach(function(card) {\n                    var show = true;\n                    if (statusFilter !== 'all' && card.dataset.status !== statusFilter) {\n                        show = false;\n                    }\n                    if (typeFilter !== 'all' && card.dataset.type !== typeFilter) {\n                        show = false;\n                    }\n                    if (difficultyFilter !== 'all' && card.dataset.difficulty !== difficultyFilter) {\n                        show = false;\n                    }\n                    card.style.display = show ? '' : 'none';\n                });\n\n                // Reset the select-all checkbox when filters change.\n                var selectAll = document.getElementById('select-all-questions');\n                if (selectAll) {\n                    selectAll.checked = false;\n                }\n            };\n\n            filterIds.forEach(function(id) {\n                var el = document.getElementById(id);\n                if (el) {\n                    el.addEventListener('change', applyFilters);\n                }\n            });\n        },\n\n        // =================================================================\n        // Step 5 - Deployment\n        // =================================================================\n\n        /**\n         * Initialize Step 5 handlers: deployment-type radio toggles and\n         * the double-submit guard on the deployment form.\n         */\n        initStep5: function() {\n            this._bindDeploymentTypeRadios();\n            this._bindDeploymentFormSubmit();\n        },\n\n        /**\n         * Bind change handlers on deployment-type radio buttons to toggle\n         * visibility of the corresponding option panels.\n         *\n         * @private\n         */\n        _bindDeploymentTypeRadios: function() {\n            document.querySelectorAll('.deploy-type-radio').forEach(function(radio) {\n                radio.addEventListener('change', function() {\n                    var newQuizOptions = document.getElementById('new_quiz_options');\n                    var qbankOptions = document.getElementById('qbank_options');\n                    var newQuizRadio = document.getElementById('deploy_new_quiz');\n                    var qbankRadio = document.getElementById('deploy_qbank');\n\n                    if (newQuizOptions) {\n                        newQuizOptions.style.display = (newQuizRadio && newQuizRadio.checked) ? 'block' : 'none';\n                    }\n                    if (qbankOptions) {\n                        qbankOptions.style.display = (qbankRadio && qbankRadio.checked) ? 'block' : 'none';\n                    }\n                });\n            });\n        },\n\n        /**\n         * Bind the submit handler on the deployment form to prevent\n         * double-submission and provide visual feedback.\n         *\n         * @private\n         */\n        _bindDeploymentFormSubmit: function() {\n            var deploymentForm = document.getElementById('deployment-form');\n            var isSubmitting = false;\n\n            if (deploymentForm) {\n                deploymentForm.addEventListener('submit', function(e) {\n                    if (isSubmitting) {\n                        e.preventDefault();\n                        return;\n                    }\n                    isSubmitting = true;\n                    var submitBtn = deploymentForm.querySelector('button[type=\"submit\"]');\n                    if (submitBtn) {\n                        submitBtn.disabled = true;\n                        submitBtn.textContent = 'Deploying...';\n                    }\n                });\n            }\n        }\n    };\n\n    // =====================================================================\n    // Public API\n    // =====================================================================\n\n    return /** @alias module:local_hlai_quizgen/wizard */ {\n\n        /**\n         * Entry point called by Moodle's AMD loader.\n         *\n         * @param {Object} config - Configuration object from PHP.\n         */\n        init: function(config) {\n            $(document).ready(function() {\n                Wizard.init(config);\n            });\n        }\n    };\n});\n"],"names":["define","$","Wizard","config","init","String","step","this","initStep1","initStep3","initProgressStep","initStep4","initStep5","_bindStep1FormSubmit","_bindContentSourceToggles","_bindFileInputChange","_bindActivitySelectionControls","self","form","document","getElementById","querySelector","addEventListener","e","_validateStep1Form","preventDefault","states","_getSourceStates","_validateSourceSelected","manualChecked","_validateManualSource","uploadChecked","_validateUploadSource","urlChecked","_validateUrlSource","activitiesChecked","_validateActivitySource","get","id","el","checked","scanCourseChecked","scanResourcesChecked","scanActivitiesChecked","alert","manualTextEl","manualText","value","trim","fileInput","files","length","maxFileSizeMB","oversizedFiles","Array","from","forEach","file","size","push","name","toFixed","join","urlListEl","urlList","querySelectorAll","cb","_toggleContentSection","dataset","source","checkbox","section","style","display","_updateSelectedSources","checkboxes","list","sources","label","textContent","fileCount","target","nextElementSibling","fileList","hasOversizedFiles","oversizedFileNames","innerText","fileNames","safeEl","createElement","safeFileName","innerHTML","fileSizeMB","sizeClass","fname","chooseFilesText","strings","choose_files","selectAllBtn","_updateActivityCount","deselectAllBtn","countDisplay","selectedBar","text","classList","add","remove","card","closest","_bindDifficultyButtons","_bindBloomsSliders","_bindQuestionTypeDistribution","_bindStep3FormSubmit","radio","btn","parentElement","slider","_updateSliderColor","_updateBloomsTotal","color","valueEl","background","total","level","parseInt","totalElem","totalInput","_updateQuestionTypeDistribution","input","_updateQuestionTypeTotal","displayEl","parts","split","max","totalRequired","val","configForm","generateBtn","loadingOverlay","isSubmitting","disabled","refreshUrl","setTimeout","window","location","href","_bindSelectAllQuestions","_bindBulkAction","_bindQuestionFilters","selectAll","bulkBtn","selectEl","action","selectedQuestions","questionId","confirmMsg","confirm","method","sesskeyInput","type","M","cfg","sesskey","appendChild","actionInput","qid","qInput","body","submit","filterIds","applyFilters","statusEl","typeEl","difficultyEl","statusFilter","typeFilter","difficultyFilter","show","status","difficulty","_bindDeploymentTypeRadios","_bindDeploymentFormSubmit","newQuizOptions","qbankOptions","newQuizRadio","qbankRadio","deploymentForm","submitBtn","ready"],"mappings":"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"}