/**
 * AI Quiz Generator - Wizard Module
 *
 * Handles all wizard step interactions, form validation, and UI behaviour
 * across the 5-step quiz generation wizard. Replaces inline JavaScript
 * previously embedded in wizard.php.
 *
 * Initialized via:
 *   $PAGE->requires->js_call_amd('local_hlai_quizgen/wizard', 'init', [$jsconfig]);
 *
 * @module     local_hlai_quizgen/wizard
 * @copyright  2025 Human Logic Software LLC
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_hlai_quizgen/wizard",["jquery"],function($){var Wizard={config:{},init:function(config){switch(this.config=config,String(config.step)){case"1":this.initStep1();break;case"3":this.initStep3();break;case"3.5":this.initProgressStep();break;case"4":this.initStep4();break;case"5":this.initStep5()}},initStep1:function(){this._bindStep1FormSubmit(),this._bindContentSourceToggles(),this._bindFileInputChange(),this._bindActivitySelectionControls()},_bindStep1FormSubmit:function(){var self=this,form=document.getElementById("content-upload-form");form||(form=document.querySelector('form[enctype="multipart/form-data"]')),form&&form.addEventListener("submit",function(e){self._validateStep1Form()||e.preventDefault()})},_validateStep1Form:function(){var states=this._getSourceStates();return!!this._validateSourceSelected(states)&&(!(states.manualChecked&&!this._validateManualSource())&&(!(states.uploadChecked&&!this._validateUploadSource())&&(!(states.urlChecked&&!this._validateUrlSource())&&!(states.activitiesChecked&&!this._validateActivitySource()))))},_getSourceStates:function(){var get=function(id){var el=document.getElementById(id);return!!el&&el.checked};return{manualChecked:get("source_manual"),uploadChecked:get("source_upload"),urlChecked:get("source_url"),activitiesChecked:get("source_activities"),scanCourseChecked:get("source_scan_course"),scanResourcesChecked:get("source_scan_resources"),scanActivitiesChecked:get("source_scan_activities")}},_validateSourceSelected:function(states){return!!(states.manualChecked||states.uploadChecked||states.urlChecked||states.activitiesChecked||states.scanCourseChecked||states.scanResourcesChecked||states.scanActivitiesChecked)||(alert("Please select at least one content source!"),!1)},_validateManualSource:function(){var manualTextEl=document.getElementById("manual_text");return""!==(manualTextEl?manualTextEl.value.trim():"")||(alert("Please enter some manual text or uncheck the Manual Entry option."),!1)},_validateUploadSource:function(){var fileInput=document.getElementById("content-files"),files=fileInput?fileInput.files:[];if(0===files.length)return alert("Please select files to upload or uncheck the Upload Files option."),!1;var oversizedFiles=[];return Array.from(files).forEach(function(file){file.size>52428800&&oversizedFiles.push(file.name+" ("+(file.size/1024/1024).toFixed(2)+" MB)")}),!(oversizedFiles.length>0)||(alert("The following files exceed the maximum size of 50 MB:\n\n"+oversizedFiles.join("\n")+"\n\nPlease remove these files and try again."),!1)},_validateUrlSource:function(){var urlListEl=document.getElementById("url_list");return""!==(urlListEl?urlListEl.value.trim():"")||(alert("Please enter at least one URL or uncheck the URL option."),!1)},_validateActivitySource:function(){return 0!==document.querySelectorAll(".hlai-activity-checkbox:checked").length||(alert("Please select at least one activity or uncheck the Course Activities option."),!1)},_bindContentSourceToggles:function(){var self=this;document.querySelectorAll(".content-source-checkbox[data-source]").forEach(function(cb){cb.addEventListener("change",function(){self._toggleContentSection(this.dataset.source)})})},_toggleContentSection:function(source){var checkbox=document.getElementById("source_"+source),section=document.getElementById("section-"+source);section&&checkbox&&(section.style.display=checkbox.checked?"block":"none"),this._updateSelectedSources()},_updateSelectedSources:function(){var checkboxes=document.querySelectorAll(".content-source-checkbox:checked"),display=document.getElementById("selected-sources-display"),list=document.getElementById("selected-sources-list");if(checkboxes.length>0){var sources=[];checkboxes.forEach(function(cb){var label=document.querySelector('label[for="'+cb.id+'"] strong');label&&sources.push(label.textContent)}),list&&(list.textContent=sources.join(" + ")),display&&(display.style.display="block")}else display&&(display.style.display="none")},_bindFileInputChange:function(){var self=this,fileInput=document.getElementById("content-files");fileInput&&fileInput.addEventListener("change",function(e){var fileCount=e.target.files.length,label=e.target.nextElementSibling,fileList=document.getElementById("uploaded-files-list"),hasOversizedFiles=!1,oversizedFileNames=[];if(fileCount>0){label&&(label.innerText=fileCount+" file(s) selected");var fileNames='<div class="mt-2"><strong>Selected files:</strong><ul class="mb-0">';Array.from(e.target.files).forEach(function(file){var safeEl=document.createElement("div");safeEl.textContent=file.name;var safeFileName=safeEl.innerHTML,fileSizeMB=(file.size/1024/1024).toFixed(2),sizeClass=file.size>52428800?"text-danger":"text-muted";file.size>52428800?(hasOversizedFiles=!0,oversizedFileNames.push(file.name+" ("+fileSizeMB+" MB)"),fileNames+='<li class="text-danger">'+safeFileName+' <span class="'+sizeClass+'">('+fileSizeMB+" MB) - TOO LARGE!</span></li>"):fileNames+="<li>"+safeFileName+' <span class="'+sizeClass+'">('+fileSizeMB+" MB)</span></li>"}),fileNames+="</ul></div>",hasOversizedFiles&&(fileNames+='<div class="notification is-danger is-light mt-2"><strong>Error:</strong> The following files exceed the maximum size of 50 MB:<ul>',oversizedFileNames.forEach(function(fname){fileNames+="<li>"+fname+"</li>"}),fileNames+="</ul>Please remove these files before submitting.</div>"),fileList&&(fileList.innerHTML=fileNames)}else{var chooseFilesText=self.config.strings&&self.config.strings.choose_files?self.config.strings.choose_files:"Choose files...";label&&(label.innerText=chooseFilesText),fileList&&(fileList.innerHTML="")}})},_bindActivitySelectionControls:function(){var self=this,selectAllBtn=document.getElementById("select-all-activities");selectAllBtn&&selectAllBtn.addEventListener("click",function(){document.querySelectorAll(".hlai-activity-checkbox").forEach(function(cb){cb.checked=!0}),self._updateActivityCount()});var deselectAllBtn=document.getElementById("deselect-all-activities");deselectAllBtn&&deselectAllBtn.addEventListener("click",function(){document.querySelectorAll(".hlai-activity-checkbox").forEach(function(cb){cb.checked=!1}),self._updateActivityCount()}),document.querySelectorAll(".hlai-activity-checkbox").forEach(function(cb){cb.addEventListener("change",function(){self._updateActivityCount()})}),this._updateActivityCount()},_updateActivityCount:function(){var checked=document.querySelectorAll(".hlai-activity-checkbox:checked").length,countDisplay=document.getElementById("selected-activities-count"),selectedBar=document.querySelector(".hlai-activities-selected-bar");if(countDisplay){var text=1===checked?"1 activity selected":checked+" activities selected";countDisplay.textContent=text}selectedBar&&(checked>0?selectedBar.classList.add("has-selection"):selectedBar.classList.remove("has-selection")),document.querySelectorAll(".hlai-activity-checkbox").forEach(function(cb){var card=cb.closest(".hlai-activity-card");card&&(cb.checked?card.classList.add("is-selected"):card.classList.remove("is-selected"))})},initStep3:function(){this._bindDifficultyButtons(),this._bindBloomsSliders(),this._bindQuestionTypeDistribution(),this._bindStep3FormSubmit()},_bindDifficultyButtons:function(){document.querySelectorAll('.hlai-diff-btn input[type="radio"]').forEach(function(radio){radio.addEventListener("change",function(){document.querySelectorAll(".hlai-diff-btn").forEach(function(btn){btn.classList.remove("is-active")}),this.parentElement&&this.parentElement.classList.add("is-active")})})},_bindBloomsSliders:function(){var self=this;document.querySelectorAll('input[type="range"][id^="blooms_"]').forEach(function(slider){self._updateSliderColor(slider),slider.addEventListener("input",function(){self._updateSliderColor(this),self._updateBloomsTotal()})}),this._updateBloomsTotal()},_updateSliderColor:function(slider){var value=slider.value,id=slider.id,color=slider.dataset.color||"#6366f1",valueEl=document.getElementById(id+"_value");valueEl&&(valueEl.textContent=value+"%"),slider.style.background="linear-gradient(to right, "+color+" 0%, "+color+" "+value+"%, #e2e8f0 "+value+"%, #e2e8f0 100%)"},_updateBloomsTotal:function(){var total=0;["remember","understand","apply","analyze","evaluate","create"].forEach(function(level){var slider=document.getElementById("blooms_"+level);slider&&(total+=parseInt(slider.value,10))});var totalElem=document.getElementById("blooms_total");totalElem&&(totalElem.textContent=total+"%",totalElem.style.color=100===total?"#10b981":total>80&&total<120?"#f59e0b":"#ef4444")},_bindQuestionTypeDistribution:function(){var self=this,totalInput=document.getElementById("total-questions");totalInput&&totalInput.addEventListener("input",function(){self._updateQuestionTypeDistribution()}),document.querySelectorAll(".hlai-qtype-input").forEach(function(input){input.addEventListener("input",function(){self._updateQuestionTypeTotal()})}),this._updateQuestionTypeTotal()},_updateQuestionTypeDistribution:function(){var totalInput=document.getElementById("total-questions"),total=totalInput&&parseInt(totalInput.value,10)||10,displayEl=document.getElementById("qtype-total-display");if(displayEl){var parts=displayEl.textContent.split("/");displayEl.textContent=(parts[0]?parts[0].trim():"0")+" / "+total}document.querySelectorAll(".hlai-qtype-input").forEach(function(input){input.max=total}),this._updateQuestionTypeTotal()},_updateQuestionTypeTotal:function(){var totalInput=document.getElementById("total-questions"),totalRequired=totalInput&&parseInt(totalInput.value,10)||10,total=0;document.querySelectorAll(".hlai-qtype-input").forEach(function(input){var val=parseInt(input.value,10)||0;total+=val,val>0?input.classList.add("has-value"):input.classList.remove("has-value")});var displayEl=document.getElementById("qtype-total-display");displayEl&&(displayEl.textContent=total+" / "+totalRequired,displayEl.classList.remove("is-valid","is-warning","is-error"),total===totalRequired?displayEl.classList.add("is-valid"):total>totalRequired?displayEl.classList.add("is-error"):displayEl.classList.add("is-warning"))},_bindStep3FormSubmit:function(){var configForm=document.getElementById("question-config-form"),generateBtn=document.getElementById("generate-btn"),loadingOverlay=document.getElementById("loading-overlay"),totalInput=document.getElementById("total-questions"),isSubmitting=!1;configForm&&configForm.addEventListener("submit",function(e){var totalRequired=totalInput&&parseInt(totalInput.value,10)||10,total=0;return document.querySelectorAll(".hlai-qtype-input").forEach(function(input){total+=parseInt(input.value,10)||0}),0===total?(e.preventDefault(),void alert("Please specify at least one question type with a quantity greater than 0.")):total!==totalRequired?(e.preventDefault(),void alert("Question type total ("+total+") must equal total questions ("+totalRequired+").")):void(isSubmitting?e.preventDefault():(isSubmitting=!0,loadingOverlay&&(loadingOverlay.style.display="flex"),generateBtn&&(generateBtn.disabled=!0,generateBtn.textContent="Generating...")))})},initProgressStep:function(){var refreshUrl=this.config.refreshUrl;refreshUrl&&setTimeout(function(){window.location.href=refreshUrl},2e3)},initStep4:function(){this._bindSelectAllQuestions(),this._bindBulkAction(),this._bindQuestionFilters()},_bindSelectAllQuestions:function(){var selectAll=document.getElementById("select-all-questions");selectAll&&selectAll.addEventListener("change",function(){var checked=this.checked;document.querySelectorAll(".question-checkbox").forEach(function(checkbox){var card=checkbox.closest(".question-card");card&&"none"!==card.style.display&&(checkbox.checked=checked)})})},_bindBulkAction:function(){var bulkBtn=document.getElementById("bulk-action-btn");bulkBtn&&bulkBtn.addEventListener("click",function(){var selectEl=document.getElementById("bulk-action-select"),action=selectEl?selectEl.value:"";if(action){var selectedQuestions=[];if(document.querySelectorAll(".question-checkbox:checked").forEach(function(checkbox){selectedQuestions.push(checkbox.dataset.questionId)}),0!==selectedQuestions.length){var confirmMsg="Are you sure you want to "+action+" "+selectedQuestions.length+" question(s)?";if(confirm(confirmMsg)){var form=document.createElement("form");form.method="POST",form.action=window.location.href;var sesskeyInput=document.createElement("input");sesskeyInput.type="hidden",sesskeyInput.name="sesskey",sesskeyInput.value=M.cfg.sesskey,form.appendChild(sesskeyInput);var actionInput=document.createElement("input");actionInput.type="hidden",actionInput.name="bulk_action",actionInput.value=action,form.appendChild(actionInput),selectedQuestions.forEach(function(qid){var qInput=document.createElement("input");qInput.type="hidden",qInput.name="question_ids[]",qInput.value=qid,form.appendChild(qInput)}),document.body.appendChild(form),form.submit()}}else alert("Please select at least one question")}else alert("Please select an action")})},_bindQuestionFilters:function(){var applyFilters=function(){var statusEl=document.getElementById("filter-status"),typeEl=document.getElementById("filter-type"),difficultyEl=document.getElementById("filter-difficulty"),statusFilter=statusEl?statusEl.value:"all",typeFilter=typeEl?typeEl.value:"all",difficultyFilter=difficultyEl?difficultyEl.value:"all";document.querySelectorAll(".question-card").forEach(function(card){var show=!0;"all"!==statusFilter&&card.dataset.status!==statusFilter&&(show=!1),"all"!==typeFilter&&card.dataset.type!==typeFilter&&(show=!1),"all"!==difficultyFilter&&card.dataset.difficulty!==difficultyFilter&&(show=!1),card.style.display=show?"":"none"});var selectAll=document.getElementById("select-all-questions");selectAll&&(selectAll.checked=!1)};["filter-status","filter-type","filter-difficulty"].forEach(function(id){var el=document.getElementById(id);el&&el.addEventListener("change",applyFilters)})},initStep5:function(){this._bindDeploymentTypeRadios(),this._bindDeploymentFormSubmit()},_bindDeploymentTypeRadios:function(){document.querySelectorAll(".deploy-type-radio").forEach(function(radio){radio.addEventListener("change",function(){var newQuizOptions=document.getElementById("new_quiz_options"),qbankOptions=document.getElementById("qbank_options"),newQuizRadio=document.getElementById("deploy_new_quiz"),qbankRadio=document.getElementById("deploy_qbank");newQuizOptions&&(newQuizOptions.style.display=newQuizRadio&&newQuizRadio.checked?"block":"none"),qbankOptions&&(qbankOptions.style.display=qbankRadio&&qbankRadio.checked?"block":"none")})})},_bindDeploymentFormSubmit:function(){var deploymentForm=document.getElementById("deployment-form"),isSubmitting=!1;deploymentForm&&deploymentForm.addEventListener("submit",function(e){if(isSubmitting)e.preventDefault();else{isSubmitting=!0;var submitBtn=deploymentForm.querySelector('button[type="submit"]');submitBtn&&(submitBtn.disabled=!0,submitBtn.textContent="Deploying...")}})}};return{init:function(config){$(document).ready(function(){Wizard.init(config)})}}});

//# sourceMappingURL=wizard.min.js.map