/**
 * AI Quiz Generator - Wizard Module
 *
 * Handles all wizard step interactions, form validation, and UI behaviour
 * across the 5-step quiz generation wizard. Replaces inline JavaScript
 * previously embedded in wizard.php.
 *
 * Initialized via:
 *   $PAGE->requires->js_call_amd('local_hlai_quizgen/wizard', 'init', [$jsconfig]);
 *
 * @module     local_hlai_quizgen/wizard
 * @copyright  2025 Human Logic Software LLC
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["jquery"],function(e){"use strict";var t={config:{},init:function(e){switch(this.config=e,String(e.step)){case"1":this.initStep1();break;case"3":this.initStep3();break;case"3.5":this.initProgressStep();break;case"4":this.initStep4();break;case"5":this.initStep5()}},initStep1:function(){this._bindStep1FormSubmit(),this._bindContentSourceToggles(),this._bindFileInputChange(),this._bindActivitySelectionControls()},_bindStep1FormSubmit:function(){var e=this,t=document.getElementById("content-upload-form");t||(t=document.querySelector('form[enctype="multipart/form-data"]')),t&&t.addEventListener("submit",function(t){e._validateStep1Form()||t.preventDefault()})},_validateStep1Form:function(){var e=this._getSourceStates();return!!this._validateSourceSelected(e)&&(!(e.manualChecked&&!this._validateManualSource())&&(!(e.uploadChecked&&!this._validateUploadSource())&&(!(e.urlChecked&&!this._validateUrlSource())&&!(e.activitiesChecked&&!this._validateActivitySource()))))},_getSourceStates:function(){var e=function(e){var t=document.getElementById(e);return!!t&&t.checked};return{manualChecked:e("source_manual"),uploadChecked:e("source_upload"),urlChecked:e("source_url"),activitiesChecked:e("source_activities"),scanCourseChecked:e("source_scan_course"),scanResourcesChecked:e("source_scan_resources"),scanActivitiesChecked:e("source_scan_activities")}},_validateSourceSelected:function(e){return!!(e.manualChecked||e.uploadChecked||e.urlChecked||e.activitiesChecked||e.scanCourseChecked||e.scanResourcesChecked||e.scanActivitiesChecked)||(alert("Please select at least one content source!"),!1)},_validateManualSource:function(){var e=document.getElementById("manual_text");return""!==(e?e.value.trim():"")||(alert("Please enter some manual text or uncheck the Manual Entry option."),!1)},_validateUploadSource:function(){var e=document.getElementById("content-files"),t=e?e.files:[];if(0===t.length)return alert("Please select files to upload or uncheck the Upload Files option."),!1;var n=[];return Array.from(t).forEach(function(e){e.size>52428800&&n.push(e.name+" ("+(e.size/1024/1024).toFixed(2)+" MB)")}),!(n.length>0)||(alert("The following files exceed the maximum size of 50 MB:\n\n"+n.join("\n")+"\n\nPlease remove these files and try again."),!1)},_validateUrlSource:function(){var e=document.getElementById("url_list");return""!==(e?e.value.trim():"")||(alert("Please enter at least one URL or uncheck the URL option."),!1)},_validateActivitySource:function(){return 0!==document.querySelectorAll(".hlai-activity-checkbox:checked").length||(alert("Please select at least one activity or uncheck the Course Activities option."),!1)},_bindContentSourceToggles:function(){var e=this;document.querySelectorAll(".content-source-checkbox[data-source]").forEach(function(t){t.addEventListener("change",function(){e._toggleContentSection(this.dataset.source)})})},_toggleContentSection:function(e){var t=document.getElementById("source_"+e),n=document.getElementById("section-"+e);n&&t&&(n.style.display=t.checked?"block":"none"),this._updateSelectedSources()},_updateSelectedSources:function(){var e=document.querySelectorAll(".content-source-checkbox:checked"),t=document.getElementById("selected-sources-display"),n=document.getElementById("selected-sources-list");if(e.length>0){var i=[];e.forEach(function(e){var t=document.querySelector('label[for="'+e.id+'"] strong');t&&i.push(t.textContent)}),n&&(n.textContent=i.join(" + ")),t&&(t.style.display="block")}else t&&(t.style.display="none")},_bindFileInputChange:function(){var e=this,t=document.getElementById("content-files");t&&t.addEventListener("change",function(t){var n=t.target.files.length,i=t.target.nextElementSibling,o=document.getElementById("uploaded-files-list"),c=52428800,a=!1,l=[];if(n>0){i&&(i.innerText=n+" file(s) selected");var s='<div class="mt-2"><strong>Selected files:</strong><ul class="mb-0">';Array.from(t.target.files).forEach(function(e){var t=document.createElement("div");t.textContent=e.name;var n=t.innerHTML,i=(e.size/1024/1024).toFixed(2),o=e.size>c?"text-danger":"text-muted";e.size>c?(a=!0,l.push(e.name+" ("+i+" MB)"),s+='<li class="text-danger">'+n+' <span class="'+o+'">('+i+" MB) - TOO LARGE!</span></li>"):s+="<li>"+n+' <span class="'+o+'">('+i+" MB)</span></li>"}),s+="</ul></div>",a&&(s+='<div class="notification is-danger is-light mt-2"><strong>Error:</strong> The following files exceed the maximum size of 50 MB:<ul>',l.forEach(function(e){s+="<li>"+e+"</li>"}),s+="</ul>Please remove these files before submitting.</div>"),o&&(o.innerHTML=s)}else{var u=e.config.strings&&e.config.strings.choose_files?e.config.strings.choose_files:"Choose files...";i&&(i.innerText=u),o&&(o.innerHTML="")}})},_bindActivitySelectionControls:function(){var e=this,t=document.getElementById("select-all-activities");t&&t.addEventListener("click",function(){document.querySelectorAll(".hlai-activity-checkbox").forEach(function(e){e.checked=!0}),e._updateActivityCount()});var n=document.getElementById("deselect-all-activities");n&&n.addEventListener("click",function(){document.querySelectorAll(".hlai-activity-checkbox").forEach(function(e){e.checked=!1}),e._updateActivityCount()}),document.querySelectorAll(".hlai-activity-checkbox").forEach(function(t){t.addEventListener("change",function(){e._updateActivityCount()})}),this._updateActivityCount()},_updateActivityCount:function(){var e=document.querySelectorAll(".hlai-activity-checkbox:checked").length,t=document.getElementById("selected-activities-count"),n=document.querySelector(".hlai-activities-selected-bar");if(t){var i=1===e?"1 activity selected":e+" activities selected";t.textContent=i}n&&(e>0?n.classList.add("has-selection"):n.classList.remove("has-selection")),document.querySelectorAll(".hlai-activity-checkbox").forEach(function(e){var t=e.closest(".hlai-activity-card");t&&(e.checked?t.classList.add("is-selected"):t.classList.remove("is-selected"))})},initStep3:function(){this._bindDifficultyButtons(),this._bindBloomsSliders(),this._bindQuestionTypeDistribution(),this._bindStep3FormSubmit()},_bindDifficultyButtons:function(){document.querySelectorAll('.hlai-diff-btn input[type="radio"]').forEach(function(e){e.addEventListener("change",function(){document.querySelectorAll(".hlai-diff-btn").forEach(function(e){e.classList.remove("is-active")}),this.parentElement&&this.parentElement.classList.add("is-active")})})},_bindBloomsSliders:function(){var e=this;document.querySelectorAll('input[type="range"][id^="blooms_"]').forEach(function(t){e._updateSliderColor(t),t.addEventListener("input",function(){e._updateSliderColor(this),e._updateBloomsTotal()})}),this._updateBloomsTotal()},_updateSliderColor:function(e){var t=e.value,n=e.id,i=e.dataset.color||"#6366f1",o=document.getElementById(n+"_value");o&&(o.textContent=t+"%"),e.style.background="linear-gradient(to right, "+i+" 0%, "+i+" "+t+"%, #e2e8f0 "+t+"%, #e2e8f0 100%)"},_updateBloomsTotal:function(){var e=0;["remember","understand","apply","analyze","evaluate","create"].forEach(function(t){var n=document.getElementById("blooms_"+t);n&&(e+=parseInt(n.value,10))});var t=document.getElementById("blooms_total");t&&(t.textContent=e+"%",t.style.color=100===e?"#10b981":e>80&&e<120?"#f59e0b":"#ef4444")},_bindQuestionTypeDistribution:function(){var e=this,t=document.getElementById("total-questions");t&&t.addEventListener("input",function(){e._updateQuestionTypeDistribution()}),document.querySelectorAll(".hlai-qtype-input").forEach(function(t){t.addEventListener("input",function(){e._updateQuestionTypeTotal()})}),this._updateQuestionTypeTotal()},_updateQuestionTypeDistribution:function(){var e=document.getElementById("total-questions"),t=e&&parseInt(e.value,10)||10,n=document.getElementById("qtype-total-display");if(n){var i=n.textContent.split("/");n.textContent=(i[0]?i[0].trim():"0")+" / "+t}document.querySelectorAll(".hlai-qtype-input").forEach(function(e){e.max=t}),this._updateQuestionTypeTotal()},_updateQuestionTypeTotal:function(){var e=document.getElementById("total-questions"),t=e&&parseInt(e.value,10)||10,n=0;document.querySelectorAll(".hlai-qtype-input").forEach(function(e){var t=parseInt(e.value,10)||0;n+=t,t>0?e.classList.add("has-value"):e.classList.remove("has-value")});var i=document.getElementById("qtype-total-display");i&&(i.textContent=n+" / "+t,i.classList.remove("is-valid","is-warning","is-error"),n===t?i.classList.add("is-valid"):n>t?i.classList.add("is-error"):i.classList.add("is-warning"))},_bindStep3FormSubmit:function(){var e=document.getElementById("question-config-form"),t=document.getElementById("generate-btn"),n=document.getElementById("loading-overlay"),i=document.getElementById("total-questions"),o=!1;e&&e.addEventListener("submit",function(e){var c=i&&parseInt(i.value,10)||10,a=0;return document.querySelectorAll(".hlai-qtype-input").forEach(function(e){a+=parseInt(e.value,10)||0}),0===a?(e.preventDefault(),void alert("Please specify at least one question type with a quantity greater than 0.")):a!==c?(e.preventDefault(),void alert("Question type total ("+a+") must equal total questions ("+c+").")):void(o?e.preventDefault():(o=!0,n&&(n.style.display="flex"),t&&(t.disabled=!0,t.textContent="Generating...")))})},initProgressStep:function(){var e=this.config.refreshUrl;e&&setTimeout(function(){window.location.href=e},2e3)},initStep4:function(){this._bindSelectAllQuestions(),this._bindBulkAction(),this._bindQuestionFilters()},_bindSelectAllQuestions:function(){var e=document.getElementById("select-all-questions");e&&e.addEventListener("change",function(){var e=this.checked;document.querySelectorAll(".question-checkbox").forEach(function(t){var n=t.closest(".question-card");n&&"none"!==n.style.display&&(t.checked=e)})})},_bindBulkAction:function(){var e=document.getElementById("bulk-action-btn");e&&e.addEventListener("click",function(){var e=document.getElementById("bulk-action-select"),t=e?e.value:"";if(t){var n=[];if(document.querySelectorAll(".question-checkbox:checked").forEach(function(e){n.push(e.dataset.questionId)}),0!==n.length){var i="Are you sure you want to "+t+" "+n.length+" question(s)?";if(confirm(i)){var o=document.createElement("form");o.method="POST",o.action=window.location.href;var c=document.createElement("input");c.type="hidden",c.name="sesskey",c.value=M.cfg.sesskey,o.appendChild(c);var a=document.createElement("input");a.type="hidden",a.name="bulk_action",a.value=t,o.appendChild(a),n.forEach(function(e){var t=document.createElement("input");t.type="hidden",t.name="question_ids[]",t.value=e,o.appendChild(t)}),document.body.appendChild(o),o.submit()}}else alert("Please select at least one question")}else alert("Please select an action")})},_bindQuestionFilters:function(){var e=function(){var e=document.getElementById("filter-status"),t=document.getElementById("filter-type"),n=document.getElementById("filter-difficulty"),i=e?e.value:"all",o=t?t.value:"all",c=n?n.value:"all";document.querySelectorAll(".question-card").forEach(function(e){var t=!0;"all"!==i&&e.dataset.status!==i&&(t=!1),"all"!==o&&e.dataset.type!==o&&(t=!1),"all"!==c&&e.dataset.difficulty!==c&&(t=!1),e.style.display=t?"":"none"});var a=document.getElementById("select-all-questions");a&&(a.checked=!1)};["filter-status","filter-type","filter-difficulty"].forEach(function(t){var n=document.getElementById(t);n&&n.addEventListener("change",e)})},initStep5:function(){this._bindDeploymentTypeRadios(),this._bindDeploymentFormSubmit()},_bindDeploymentTypeRadios:function(){document.querySelectorAll(".deploy-type-radio").forEach(function(e){e.addEventListener("change",function(){var e=document.getElementById("new_quiz_options"),t=document.getElementById("qbank_options"),n=document.getElementById("deploy_new_quiz"),i=document.getElementById("deploy_qbank");e&&(e.style.display=n&&n.checked?"block":"none"),t&&(t.style.display=i&&i.checked?"block":"none")})})},_bindDeploymentFormSubmit:function(){var e=document.getElementById("deployment-form"),t=!1;e&&e.addEventListener("submit",function(n){if(t)n.preventDefault();else{t=!0;var i=e.querySelector('button[type="submit"]');i&&(i.disabled=!0,i.textContent="Deploying...")}})}};return{init:function(n){e(document).ready(function(){t.init(n)})}}});
//# sourceMappingURL=wizard.min.js.map