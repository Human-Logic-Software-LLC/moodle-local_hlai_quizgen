/**
 * AI Quiz Generator - Dashboard Module
 *
 * Handles dashboard initialization, AJAX data fetching,
 * and chart rendering for the teacher dashboard.
 *
 * @module     local_hlai_quizgen/dashboard
 * @copyright  2025 Human Logic Software LLC
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["jquery","core/ajax","local_hlai_quizgen/charts"],function(t,e,a){"use strict";var r={courseid:0,refreshInterval:null,charts:{},init:function(t){this.courseid=t.courseid,this.initData=t,this.waitForApexCharts().then(function(){r.initializeCharts(),r.loadChartData(),r.setupEventListeners()}).catch(function(){})},waitForApexCharts:function(){return new Promise(function(t){if("undefined"==typeof ApexCharts)var e=0,a=setInterval(function(){e++,("undefined"!=typeof ApexCharts||e>=50)&&(clearInterval(a),t())},100);else t()})},initializeCharts:function(){var e=this.initData.stats||{};t("#ftar-gauge-chart").length&&"undefined"!=typeof ApexCharts&&(this.charts.ftarGauge=a.createRadialChart("#ftar-gauge-chart",{series:[e.ftar||0],labels:["First-Time Acceptance"],colors:[this.getFtarColor(e.ftar||0)],height:280,plotOptions:{radialBar:{startAngle:-135,endAngle:135,hollow:{margin:0,size:"70%",background:"transparent"},track:{background:"#f0f0f0",strokeWidth:"100%"},dataLabels:{name:{offsetY:-10,color:"#666",fontSize:"14px"},value:{color:"#333",fontSize:"36px",fontWeight:"bold",formatter:function(t){return t.toFixed(1)+"%"}}}}}}));var n=this.initData.typeDistribution||[];if(t("#question-type-chart").length&&n.length>0&&"undefined"!=typeof ApexCharts){var o=n.map(function(t){return r.formatQuestionType(t.questiontype)}),i=n.map(function(t){return parseInt(t.count,10)}),s=n.map(function(t){return a.getQuestionTypeColor(t.questiontype)});this.charts.questionType=a.createDonutChart("#question-type-chart",{series:i,labels:o,colors:s,height:280})}},loadChartData:function(){var t=this;this.fetchData("acceptancetrend").then(function(e){t.renderAcceptanceTrendChart(e)}).catch(function(){}),this.fetchData("difficultydist").then(function(e){t.renderDifficultyChart(e)}).catch(function(){}),this.fetchData("bloomsdist").then(function(e){t.renderBloomsCharts(e)}).catch(function(){}),this.fetchData("regenbytype").then(function(e){t.renderRegenByTypeChart(e)}).catch(function(){})},fetchData:function(t){var a=this.courseid||0,r={acceptancetrend:{methodname:"local_hlai_quizgen_get_acceptance_trend",args:{courseid:a}},difficultydist:{methodname:"local_hlai_quizgen_get_difficulty_distribution",args:{courseid:a}},bloomsdist:{methodname:"local_hlai_quizgen_get_blooms_distribution",args:{courseid:a}},regenbytype:{methodname:"local_hlai_quizgen_get_regeneration_by_type",args:{courseid:a}}}[t];return r?e.call([r])[0].then(function(e){return"regenbytype"===t?JSON.parse(e.data):e}).catch(function(e){return console.error("External service call failed for "+t+":",e),null}):Promise.reject("Unknown action: "+t)},renderAcceptanceTrendChart:function(e){if(e&&t("#acceptance-trend-chart").length&&"undefined"!=typeof ApexCharts){t("#acceptance-trend-chart").empty();var r=e.labels||[],n=e.acceptance_rates||[],o=e.ftar_rates||[];0!==r.length?this.charts.acceptanceTrend=a.createLineChart("#acceptance-trend-chart",{series:[{name:"Acceptance Rate",data:n},{name:"First-Time Acceptance",data:o}],categories:r,colors:["#4F46E5","#10B981"],height:300,stroke:{curve:"smooth",width:3},markers:{size:5},yaxis:{min:0,max:100,labels:{formatter:function(t){return t.toFixed(0)+"%"}}}}):t("#acceptance-trend-chart").html('<div class="has-text-centered has-text-grey p-5"><p>Not enough data to show trends yet.</p><p class="mt-2" style="font-size: 0.85rem;">Generate more quizzes to see patterns.</p></div>')}},renderDifficultyChart:function(e){if(e&&t("#difficulty-chart").length&&"undefined"!=typeof ApexCharts){var r=[],n=[],o=[];["easy","medium","hard"].forEach(function(t){var i=e[t]||0;i>0&&(r.push(i),n.push(t.charAt(0).toUpperCase()+t.slice(1)),o.push(a.getDifficultyColor(t)))}),0!==r.length?this.charts.difficulty=a.createDonutChart("#difficulty-chart",{series:r,labels:n,colors:o,height:280}):t("#difficulty-chart").html('<div class="has-text-centered has-text-grey p-5"><p>No difficulty data available</p></div>')}},renderBloomsCharts:function(e){if(e&&"undefined"!=typeof ApexCharts){var r=["Remember","Understand","Apply","Analyze","Evaluate","Create"],n=[],o=[];if(["remember","understand","apply","analyze","evaluate","create"].forEach(function(t){n.push(e[t]||0),o.push(a.getBloomsColor(t))}),t("#blooms-radar-chart").length){var i={chart:{type:"radar",height:400,fontFamily:"Inter, -apple-system, BlinkMacSystemFont, sans-serif",toolbar:{show:!1},dropShadow:{enabled:!0,blur:4,left:0,top:0,opacity:.1}},series:[{name:"Questions",data:n}],dataLabels:{enabled:!1},xaxis:{categories:r,labels:{show:!0,style:{colors:o,fontSize:"13px",fontWeight:600}}},yaxis:{show:!1,labels:{show:!1},tickAmount:0},grid:{show:!1},fill:{opacity:.2,type:"solid"},stroke:{width:2,colors:["#4F46E5"]},markers:{size:5,colors:["#4F46E5"],strokeColors:"#fff",strokeWidth:2,hover:{size:7}},colors:["#4F46E5"],legend:{show:!1},tooltip:{enabled:!0,y:{formatter:function(t){return t+" questions"}}},plotOptions:{radar:{size:140,polygons:{strokeColors:"#E5E7EB",strokeWidth:1,connectorColors:"#E5E7EB",fill:{colors:["#F9FAFB","#F3F4F6"]}}}}};this.charts.bloomsRadar=new ApexCharts(document.querySelector("#blooms-radar-chart"),i),this.charts.bloomsRadar.render()}if(t("#blooms-bar-chart").length){var s={chart:{type:"bar",height:400,fontFamily:"Inter, -apple-system, BlinkMacSystemFont, sans-serif",toolbar:{show:!1}},series:[{name:"Questions",data:n}],plotOptions:{bar:{horizontal:!0,borderRadius:6,distributed:!0,barHeight:"65%"}},dataLabels:{enabled:!0,style:{fontSize:"13px",fontWeight:"bold",colors:["#fff"]}},xaxis:{categories:r,labels:{style:{fontSize:"12px",colors:"#6B7280"}}},yaxis:{labels:{style:{fontSize:"13px",fontWeight:500,colors:o}}},colors:o,legend:{show:!1},tooltip:{y:{formatter:function(t){return t+" questions"}}}};this.charts.bloomsBar=new ApexCharts(document.querySelector("#blooms-bar-chart"),s),this.charts.bloomsBar.render()}}},renderRegenByTypeChart:function(e){if(e&&t("#regen-by-type-chart").length&&"undefined"!=typeof ApexCharts){var n=Object.keys(e),o=[],i=[],s=[];n.forEach(function(t){var n=e[t].avg_regenerations||0;o.push(parseFloat(n.toFixed(2))),i.push(r.formatQuestionType(t)),s.push(a.getQuestionTypeColor(t))}),0!==o.length?this.charts.regenByType=a.createBarChart("#regen-by-type-chart",{series:[{name:"Avg Regenerations",data:o}],categories:i,colors:s,horizontal:!0,height:250,distributed:!0,dataLabels:{enabled:!0,formatter:function(t){return t.toFixed(1)}}}):t("#regen-by-type-chart").html('<div class="has-text-centered has-text-grey p-4"><p>No regeneration data yet</p></div>')}},setupEventListeners:function(){var e=this;t(document).on("click",".js-refresh-dashboard",function(t){t.preventDefault(),e.refreshDashboard()}),t(document).on("click",".hlai-dismiss-notification, .hlai-notification .delete",function(){t(this).closest(".notification, .hlai-notification").fadeOut(300,function(){t(this).remove()})})},refreshDashboard:function(){Object.keys(this.charts).forEach(function(t){r.charts[t]&&"function"==typeof r.charts[t].destroy&&r.charts[t].destroy()}),this.charts={},this.loadChartData()},getFtarColor:function(t){return t>=75?"#10B981":t>=60?"#F59E0B":t>=45?"#F97316":"#EF4444"},formatQuestionType:function(t){return{multichoice:"Multiple Choice",truefalse:"True/False",shortanswer:"Short Answer",essay:"Essay",numerical:"Numerical",matching:"Matching",ordering:"Ordering",cloze:"Cloze",description:"Description"}[t]||t.charAt(0).toUpperCase()+t.slice(1)}};return{init:function(e){t(document).ready(function(){r.init(e)})}}});
//# sourceMappingURL=dashboard.min.js.map