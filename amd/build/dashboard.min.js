/**
 * AI Quiz Generator - Dashboard Module
 *
 * Handles dashboard initialization, AJAX data fetching,
 * and chart rendering for the teacher dashboard.
 *
 * @module     local_hlai_quizgen/dashboard
 * @copyright  2025 Human Logic Software LLC
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
/**
 * AI Quiz Generator - Dashboard Module
 *
 * Handles dashboard initialization, AJAX data fetching,
 * and chart rendering for the teacher dashboard.
 *
 * @module     local_hlai_quizgen/dashboard
 * @copyright  2025 Human Logic Software LLC
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_hlai_quizgen/dashboard",["jquery","core/ajax","local_hlai_quizgen/charts"],function($,Ajax,Charts){var Dashboard={courseid:0,refreshInterval:null,charts:{},init:function(config){this.courseid=config.courseid,this.initData=config,this.waitForApexCharts().then(function(){Dashboard.initializeCharts(),Dashboard.loadChartData(),Dashboard.setupEventListeners()}).catch(function(){})},waitForApexCharts:function(){return new Promise(function(resolve){if("undefined"==typeof ApexCharts)var attempts=0,checkInterval=setInterval(function(){attempts++,("undefined"!=typeof ApexCharts||attempts>=50)&&(clearInterval(checkInterval),resolve())},100);else resolve()})},initializeCharts:function(){var stats=this.initData.stats||{};$("#ftar-gauge-chart").length&&"undefined"!=typeof ApexCharts&&(this.charts.ftarGauge=Charts.createRadialChart("#ftar-gauge-chart",{series:[stats.ftar||0],labels:["First-Time Acceptance"],colors:[this.getFtarColor(stats.ftar||0)],height:280,plotOptions:{radialBar:{startAngle:-135,endAngle:135,hollow:{margin:0,size:"70%",background:"transparent"},track:{background:"#f0f0f0",strokeWidth:"100%"},dataLabels:{name:{offsetY:-10,color:"#666",fontSize:"14px"},value:{color:"#333",fontSize:"36px",fontWeight:"bold",formatter:function(val){return val.toFixed(1)+"%"}}}}}}));var typeData=this.initData.typeDistribution||[];if($("#question-type-chart").length&&typeData.length>0&&"undefined"!=typeof ApexCharts){var labels=typeData.map(function(item){return Dashboard.formatQuestionType(item.questiontype)}),series=typeData.map(function(item){return parseInt(item.count,10)}),colors=typeData.map(function(item){return Charts.getQuestionTypeColor(item.questiontype)});this.charts.questionType=Charts.createDonutChart("#question-type-chart",{series:series,labels:labels,colors:colors,height:280})}},loadChartData:function(){var self=this;this.fetchData("acceptancetrend").then(function(data){self.renderAcceptanceTrendChart(data)}).catch(function(){}),this.fetchData("difficultydist").then(function(data){self.renderDifficultyChart(data)}).catch(function(){}),this.fetchData("bloomsdist").then(function(data){self.renderBloomsCharts(data)}).catch(function(){}),this.fetchData("regenbytype").then(function(data){self.renderRegenByTypeChart(data)}).catch(function(){})},fetchData:function(action){var cid=this.courseid||0,call={acceptancetrend:{methodname:"local_hlai_quizgen_get_acceptance_trend",args:{courseid:cid}},difficultydist:{methodname:"local_hlai_quizgen_get_difficulty_distribution",args:{courseid:cid}},bloomsdist:{methodname:"local_hlai_quizgen_get_blooms_distribution",args:{courseid:cid}},regenbytype:{methodname:"local_hlai_quizgen_get_regeneration_by_type",args:{courseid:cid}}}[action];return call?Ajax.call([call])[0].then(function(response){return"regenbytype"===action?JSON.parse(response.data):response}).catch(function(error){return console.error("External service call failed for "+action+":",error),null}):Promise.reject("Unknown action: "+action)},renderAcceptanceTrendChart:function(data){if(data&&$("#acceptance-trend-chart").length&&"undefined"!=typeof ApexCharts){$("#acceptance-trend-chart").empty();var categories=data.labels||[],acceptanceRates=data.acceptance_rates||[],ftarRates=data.ftar_rates||[];0!==categories.length?this.charts.acceptanceTrend=Charts.createLineChart("#acceptance-trend-chart",{series:[{name:"Acceptance Rate",data:acceptanceRates},{name:"First-Time Acceptance",data:ftarRates}],categories:categories,colors:["#4F46E5","#10B981"],height:300,stroke:{curve:"smooth",width:3},markers:{size:5},yaxis:{min:0,max:100,labels:{formatter:function(val){return val.toFixed(0)+"%"}}}}):$("#acceptance-trend-chart").html('<div class="has-text-centered has-text-grey p-5"><p>Not enough data to show trends yet.</p><p class="mt-2" style="font-size: 0.85rem;">Generate more quizzes to see patterns.</p></div>')}},renderDifficultyChart:function(data){if(data&&$("#difficulty-chart").length&&"undefined"!=typeof ApexCharts){var series=[],labels=[],colors=[];["easy","medium","hard"].forEach(function(diff){var count=data[diff]||0;count>0&&(series.push(count),labels.push(diff.charAt(0).toUpperCase()+diff.slice(1)),colors.push(Charts.getDifficultyColor(diff)))}),0!==series.length?this.charts.difficulty=Charts.createDonutChart("#difficulty-chart",{series:series,labels:labels,colors:colors,height:280}):$("#difficulty-chart").html('<div class="has-text-centered has-text-grey p-5"><p>No difficulty data available</p></div>')}},renderBloomsCharts:function(data){if(data&&"undefined"!=typeof ApexCharts){var bloomsLabels=["Remember","Understand","Apply","Analyze","Evaluate","Create"],series=[],barColors=[];if(["remember","understand","apply","analyze","evaluate","create"].forEach(function(level){series.push(data[level]||0),barColors.push(Charts.getBloomsColor(level))}),$("#blooms-radar-chart").length){var radarOptions={chart:{type:"radar",height:400,fontFamily:"Inter, -apple-system, BlinkMacSystemFont, sans-serif",toolbar:{show:!1},dropShadow:{enabled:!0,blur:4,left:0,top:0,opacity:.1}},series:[{name:"Questions",data:series}],dataLabels:{enabled:!1},xaxis:{categories:bloomsLabels,labels:{show:!0,style:{colors:barColors,fontSize:"13px",fontWeight:600}}},yaxis:{show:!1,labels:{show:!1},tickAmount:0},grid:{show:!1},fill:{opacity:.2,type:"solid"},stroke:{width:2,colors:["#4F46E5"]},markers:{size:5,colors:["#4F46E5"],strokeColors:"#fff",strokeWidth:2,hover:{size:7}},colors:["#4F46E5"],legend:{show:!1},tooltip:{enabled:!0,y:{formatter:function(val){return val+" questions"}}},plotOptions:{radar:{size:140,polygons:{strokeColors:"#E5E7EB",strokeWidth:1,connectorColors:"#E5E7EB",fill:{colors:["#F9FAFB","#F3F4F6"]}}}}};this.charts.bloomsRadar=new ApexCharts(document.querySelector("#blooms-radar-chart"),radarOptions),this.charts.bloomsRadar.render()}if($("#blooms-bar-chart").length){var barOptions={chart:{type:"bar",height:400,fontFamily:"Inter, -apple-system, BlinkMacSystemFont, sans-serif",toolbar:{show:!1}},series:[{name:"Questions",data:series}],plotOptions:{bar:{horizontal:!0,borderRadius:6,distributed:!0,barHeight:"65%"}},dataLabels:{enabled:!0,style:{fontSize:"13px",fontWeight:"bold",colors:["#fff"]}},xaxis:{categories:bloomsLabels,labels:{style:{fontSize:"12px",colors:"#6B7280"}}},yaxis:{labels:{style:{fontSize:"13px",fontWeight:500,colors:barColors}}},colors:barColors,legend:{show:!1},tooltip:{y:{formatter:function(val){return val+" questions"}}}};this.charts.bloomsBar=new ApexCharts(document.querySelector("#blooms-bar-chart"),barOptions),this.charts.bloomsBar.render()}}},renderRegenByTypeChart:function(data){if(data&&$("#regen-by-type-chart").length&&"undefined"!=typeof ApexCharts){var types=Object.keys(data),series=[],labels=[],colors=[];types.forEach(function(type){var avgRegen=data[type].avg_regenerations||0;series.push(parseFloat(avgRegen.toFixed(2))),labels.push(Dashboard.formatQuestionType(type)),colors.push(Charts.getQuestionTypeColor(type))}),0!==series.length?this.charts.regenByType=Charts.createBarChart("#regen-by-type-chart",{series:[{name:"Avg Regenerations",data:series}],categories:labels,colors:colors,horizontal:!0,height:250,distributed:!0,dataLabels:{enabled:!0,formatter:function(val){return val.toFixed(1)}}}):$("#regen-by-type-chart").html('<div class="has-text-centered has-text-grey p-4"><p>No regeneration data yet</p></div>')}},setupEventListeners:function(){var self=this;$(document).on("click",".js-refresh-dashboard",function(e){e.preventDefault(),self.refreshDashboard()}),$(document).on("click",".hlai-dismiss-notification, .hlai-notification .delete",function(){$(this).closest(".notification, .hlai-notification").fadeOut(300,function(){$(this).remove()})})},refreshDashboard:function(){Object.keys(this.charts).forEach(function(key){Dashboard.charts[key]&&"function"==typeof Dashboard.charts[key].destroy&&Dashboard.charts[key].destroy()}),this.charts={},this.loadChartData()},getFtarColor:function(ftar){return ftar>=75?"#10B981":ftar>=60?"#F59E0B":ftar>=45?"#F97316":"#EF4444"},formatQuestionType:function(type){return{multichoice:"Multiple Choice",truefalse:"True/False",shortanswer:"Short Answer",essay:"Essay",numerical:"Numerical",matching:"Matching",ordering:"Ordering",cloze:"Cloze",description:"Description"}[type]||type.charAt(0).toUpperCase()+type.slice(1)}};return{init:function(config){$(document).ready(function(){Dashboard.init(config)})}}});

//# sourceMappingURL=dashboard.min.js.map